<?xml version="1.0" encoding="UTF-8"?>
<!--
$Id$
-->
<html
		xmlns="http://www.w3.org/1999/xhtml"
		xmlns:xf="http://www.w3.org/2002/xforms"
		xmlns:ev="http://www.w3.org/2001/xml-events"
		xmlns:xs="http://www.w3.org/2001/XMLSchema"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:xbug="http://xbug.sourceforge.net/"
		>

	<head>
		<title>xbug</title>
		<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8"/>
		<meta name="version" content="$Id$"/>
		<style type="text/css">
			@namespace xf url(http://www.w3.org/2002/xforms);
			body {
				width: 80ex;
				margin: 0 auto 0 auto;
			}
			#contents {
				width: 100%;
			}
			h3 {
				margin-top: 2em;
			}
			#bugs-repeat p xf|label {
				display: block;
			}
			xf|textarea *, xf|input * {
				width: 100%;
			}
			textarea {
				height: 5em;
			}
			:focus {
				background-color: #FF6;
			}
			#id-tag {
				color: #AAA;
			}
		</style>

		<xf:model id="xbug">

			<!-- Bugs instance and bindings -->
			<xf:instance id="bugsFile" src="bugs.xml"/>
			<xf:bind id="bugs-instance-bind" nodeset="instance('bugsFile')"/>

			<!-- Bug statuses -->
			<xf:instance id="statuses">
				<statuses xmlns="">
					<status>
						<value>Undefined</value>
					</status>
					<status>
						<value>Unconfirmed</value>
					</status>
					<status>
						<value>New</value>
					</status>
					<status>
						<value>Assigned</value>
					</status>
					<status>
						<value>Re-opened</value>
					</status>
					<status>
						<value>Resolved</value>
					</status>
					<status>
						<value>Verified</value>
					</status>
				</statuses>
			</xf:instance>

			<!-- Bug resolutions -->
			<xf:instance id="resolutions">
				<resolutions xmlns="">
					<resolution>
						<value>None</value>
					</resolution>
					<resolution>
						<value>Fixed</value>
					</resolution>
					<resolution>
						<value>Invalid</value>
					</resolution>
					<resolution>
						<value>Won't fix</value>
					</resolution>
					<resolution>
						<value>Duplicate</value>
					</resolution>
					<resolution>
						<value>Works for me</value>
					</resolution>
					<resolution>
						<value>Incomplete</value>
					</resolution>
				</resolutions>
			</xf:instance>
			<xf:bind id="resolutions-bind" nodeset="instance('resolutions')/resolutions/resolution" readonly="true()"/>

			<xf:instance id="context">
				<context xmlns="">
					<bug id="0">
						<summary/>
						<description/>
						<status>Undefined</status>
						<resolution/>
						<reporter/>
					</bug>
				</context>
			</xf:instance>

			<!-- Current bug bindings -->
			<xf:bind id="context-bug-bind" nodeset="instance('context')/bug/@id" constraint=".=instance('bugsFile')/bugs/bug/@id or .=''"/>
			<xf:bind id="context-bug-summary-bind" nodeset="instance('context')/bug/summary"/>
			<xf:bind id="context-bug-description-bind" nodeset="instance('context')/bug/description"/>
			<xf:bind id="context-bug-status-bind" nodeset="instance('context')/bug/status"/>
			<xf:bind id="context-bug-resolution-bind" nodeset="instance('context')/bug/resolution"/>
			<xf:bind id="context-bug-reporter-bind" nodeset="instance('context')/bug/reporter"/>

			<!-- Submissions and actions -->
			<xf:submission
				id="save-bugs"
				bind="bugs-instance-bind"
				action="bugs.xml"
				method="put"
				replace="none"
				indent="true()"
				/>

			<xf:action ev:event="xforms-ready">
				<!-- TODO: Load first bug into context -->
			</xf:action>
		</xf:model>
	</head>
	<body>

		<div id="contents">

			<xf:group id="bugs">
				<xf:label><h1>Bugs</h1></xf:label>

				<xf:group id="actions">
					<xf:submit submission="save-bugs" accesskey="S">
						<xf:label>Save</xf:label>
					</xf:submit>

					<xf:trigger>
						<xf:label>New</xf:label>
						<xf:action ev:event="DOMActivate">
							<xf:insert nodeset="instance('bugsFile')//xbug:bug" at="last()" position="after" ev:event="DOMActivate"/>
							<xf:setvalue ref="instance('bugsFile')//xbug:bug[last()]/@xml:id" value="instance('bugsFile')//xbug:bug[last() - 1]/@xml:id + 1"/>
							<xf:setvalue ref="instance('bugsFile')//xbug:bug[last()]/xbug:summary" value="''"/>
							<xf:setvalue ref="instance('bugsFile')//xbug:bug[last()]/xbug:description" value="''"/>
							<xf:setvalue ref="instance('bugsFile')//xbug:bug[last()]/xbug:status" value="instance('statuses')/status[1]/value"/>
							<xf:setvalue ref="instance('bugsFile')//xbug:bug[last()]/xbug:resolution" value="instance('resolutions')/resolution[1]/value"/>
						</xf:action>
					</xf:trigger>

					<xf:trigger>
						<xf:label>Delete</xf:label>
						<xf:delete nodeset="instance('bugsFile')//xbug:bug" at="index('bugs-repeat')" ev:event="DOMActivate"/>
					</xf:trigger>

				</xf:group>

				<xf:repeat id="bugs-repeat" nodeset="instance('bugsFile')//xbug:bug">
					<h3>
						<xf:output ref="@xml:id">
							<xf:label>Bug #</xf:label>
						</xf:output>
					</h3>
					<p>
						<xf:input ref="xbug:summary">
							<xf:label>Summary</xf:label>
							<xf:help>Enter the summary of the bug.</xf:help>
							<xf:hint>Try to describe in a few words what is wrong.</xf:hint>
							<xf:alert>Mandatory field.</xf:alert>
						</xf:input>
					</p>
					<p>
						<xf:textarea ref="xbug:description">
							<xf:label>Description</xf:label>
						</xf:textarea>
					</p>
					<p>
						<xf:select1 ref="xbug:status">
							<xf:label>Status</xf:label>
							<xf:itemset nodeset="instance('statuses')/status">
								<xf:label ref="value"/>
								<xf:value ref="value"/>
							</xf:itemset>
							<xf:alert>The status does not exist!</xf:alert>
						</xf:select1>
					</p>
					<p>
						<xf:select1 ref="xbug:resolution">
							<xf:label>Resolution</xf:label>
							<xf:itemset nodeset="instance('resolutions')/resolution">
								<xf:label ref="value"/>
								<xf:value ref="value"/>
							</xf:itemset>
							<xf:alert>The resolution does not exist!</xf:alert>
						</xf:select1>
					</p>
					<p>
						<xf:input ref="xbug:reporter">
							<xf:label>Reporter</xf:label>
						</xf:input>
					</p>
					</xf:repeat>
			</xf:group>
		</div>

		<div id="footer">
			<p><a href="http://xbug.sourceforge.net/" title="Bug tracking, downloads, updates, etc.">xbug homepage</a></p>
			<p>Copyright Â© 2009 Victor Engmark</p>
			<p>License: <a rel="license" href="http://www.gnu.org/licenses/gpl.html">GNU <abbr title="General Public License">GPL</abbr> v3 or newer</a></p>
			<p id="id-tag">$Id$</p>
		</div>

	</body>
</html>
